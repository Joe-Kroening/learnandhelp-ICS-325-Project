//create cause test code

<?php
  // Start or resume the session
  $status = session_status();
  if ($status == PHP_SESSION_NONE) {
    session_start();
  }

  // Include your database configuration
  require 'db_configuration.php';

  // Check if the form has been submitted
  if ($_SERVER['REQUEST_METHOD'] == 'POST') {
    // Gather data from the form
    $causeName = $_POST['cause_name'];
    $description = $_POST['description'];
    $url = $_POST['url'];
    $contactName = $_POST['contact_name'];
    $contactEmail = $_POST['contact_email'];
    $contactPhone = $_POST['contact_phone'];

    // Create a new database connection
    $connection = new mysqli(DATABASE_HOST, DATABASE_USER, DATABASE_PASSWORD, DATABASE_DATABASE);

    // Check for a successful database connection
    if ($connection->connect_error) {
      die("Failed to connect to the database: " . $connection->connect_error);
    }

    // Prepare an SQL statement to insert the new cause
    $sql = "INSERT INTO causes (Cause_name, description, URL, Contact_name, Contact_email, Contact_phone) VALUES (?, ?, ?, ?, ?, ?)";

    // Use prepared statements to prevent SQL injection
    $stmt = $connection->prepare($sql);

    if ($stmt === false) {
      die("Failed to prepare the statement: " . $connection->error);
    }

    // Bind the parameters and execute the statement
    $stmt->bind_param("ssssss", $causeName, $description, $url, $contactName, $contactEmail, $contactPhone);

    if ($stmt->execute()) {
      // Insertion was successful
      header("Location: causes.php"); // Redirect to the causes page or another appropriate location
      exit();
    } else {
      // Insertion failed
      echo "Error: " . $stmt->error;
    }

    // Close the database connection
    $stmt->close();
    $connection->close();
  }
?>
<!DOCTYPE html>
<html>
<head>
  <link rel="icon" href="images/icon_logo.png" type="image/icon type">
  <title>Learn and Help - Create Cause</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;900&display=swap" rel="stylesheet">
  <link href="css/main.css" rel="stylesheet">
</head>
<body>
  <?php include 'show-navbar.php'; ?>
  <?php show_navbar(); ?>

  <header class="inverse">
    <div class="container">
      <h1><span class="accent-text">Create New Cause</span></h1>
    </div>
  </header>

  <div class="container">
    <form action="admin_createcause.php" method="post">
      <label for="cause_name">Cause Name:</label>
      <input type="text" id="cause_name" name="cause_name" required>

      <label for="description">Description:</label>
      <textarea id="description" name="description" required></textarea>

      <label for="url">URL:</label>
      <input type="text" id="url" name="url">

      <label for="contact_name">Contact Name:</label>
      <input type="text" id="contact_name" name="contact_name" required>

      <label for="contact_email">Contact Email:</label>
      <input type="email" id="contact_email" name="contact_email" required>

      <label for="contact_phone">Contact Phone:</label>
      <input type="text" id="contact_phone" name="contact_phone" required>

      <input type="submit" value="Create Cause">
    </form>
  </div>
</body>
</html>
